<!DOCTYPE html>
<html>

<head>
    <title>Cluely WebSocket Test</title>
    <script src="https://cdn.jsdelivr.net/npm/sockjs-client@1/dist/sockjs.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/stompjs@2.3.3/lib/stomp.min.js"></script>
</head>

<body>
    <h1>Cluely WebSocket Test</h1>

    <div>
        <label>JWT Token:</label><br>
        <input type="text" id="token" style="width: 500px" placeholder="Paste JWT token here">
    </div>

    <div>
        <label>Meeting ID:</label><br>
        <input type="text" id="meetingId" style="width: 300px" placeholder="Paste meeting ID">
    </div>

    <button onclick="connect()">Connect</button>
    <button onclick="disconnect()">Disconnect</button>

    <h3>Messages:</h3>
    <div id="messages" style="border: 1px solid #ccc; padding: 10px; height: 400px; overflow-y: scroll;"></div>

    <script>
        let stompClient = null;

        function connect() {
            const token = document.getElementById('token').value;
            const meetingId = document.getElementById('meetingId').value;

            if (!token || !meetingId) {
                alert('Please enter both token and meeting ID');
                return;
            }

            const socket = new SockJS('http://localhost:8080/ws');
            stompClient = Stomp.over(socket);

            stompClient.connect(
                { 'Authorization': 'Bearer ' + token },
                function (frame) {
                    console.log('Connected:', frame);
                    addMessage('‚úÖ Connected to WebSocket!');

                    // Subscribe to meeting topic
                    stompClient.subscribe('/topic/meeting.' + meetingId, function (message) {
                        const data = JSON.parse(message.body);
                        addMessage('üìù ' + JSON.stringify(data, null, 2));
                    });

                    addMessage('üì° Subscribed to meeting: ' + meetingId);
                },
                function (error) {
                    console.error('Connection error:', error);
                    addMessage('‚ùå Connection failed: ' + error);
                }
            );
        }

        function disconnect() {
            if (stompClient !== null) {
                stompClient.disconnect();
                addMessage('üîå Disconnected');
            }
        }

        function addMessage(message) {
            const messagesDiv = document.getElementById('messages');
            const p = document.createElement('p');
            p.textContent = message;
            messagesDiv.appendChild(p);
            messagesDiv.scrollTop = messagesDiv.scrollHeight;
        }
    </script>
</body>

</html>